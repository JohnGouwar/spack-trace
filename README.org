#+TITLE: spack-trace: Generate compile_commands.json for your dev-specs
#+AUTHOR: John Gouwar
* System requirements
- ~glibc>=2.3.4~ / ~linux-kernel>=2.6.6~
- ~spack>=1.0.1~ run with appropriate setup script (_e.g._, ~. spack/share/spack/setup-env.sh~)
* A small spack environment for running the extension
#+begin_src yaml :tangle env/spack.yaml
spack:
  config:
    extensions:
      - ../
  packages:
    gcc:
      buildable: false
  specs:
  - 'python@3.12:'
  - 'gcc@11:'
  - py-pip
  - py-posixmq
  view: true
  concretizer:
    unify: true
  env_vars:
    set:
      SPACK_PYTHON: $env/.spack-env/view/bin/python3
  repos:
    extensions:
      git: "https://github.com/JohnGouwar/spack-extension-packages.git"
#+end_src
* Installing the extension
This extension relies on a small C library to extend Python, running ~make
install~ builds the C extension and adds this as a Spack extension module to your
spack config (_e.g._, ~.config/spack/config.yaml~)
* Using the extension
** Example workflow
To trace the compilation of ~zlib~ and ~mpich~, you would run the following commands
#+begin_example
$ spack env activate env/
$ spack install
$ spack trace zlib mpich
#+end_example
This will dump the source code and logged commands in ~/path/to/spack-trace/sources~,
use ~spack trace --help~ for more details on configuration.
# Local Variables:
# eval: (add-hook 'after-save-hook 'john/org-tangle-with-prompt nil t)
# End:
